# ==============================
# Ruff Configuration (.ruff.toml)
# 兼容 Ruff ≥ 0.2.x（使用新 lint 段落）
# ==============================

line-length = 100
fix = true

[lint]
# 启用最常用的规则族
select = ["E", "F"]
# 全局忽略（保持克制）
ignore = ["E203", "E266", "E501"]
# 全局排除目录
exclude = [".git", ".venv", "__pycache__", "alembic/versions"]

# ------------------------------
# 按文件/目录定向豁免
# ------------------------------
[lint.per-file-ignores]
# === 常规测试目录 ===
"tests/**" = ["E402", "E501", "F401", "F841"]
# === 工具 / 脚本 / 历史兼容 ===
"backup_routers/**" = ["E741"]
"tools/**" = ["E741"]
"scripts/**" = ["E402", "E702"]
"alembic/env.py" = ["E402"]
"app/main.py" = ["E402"]
"app/api/routers/platform_shops.py" = ["F821"]
"app/services/order_service.py" = ["E701"]
"app/api/routers/orders.py" = ["E741"]
"app/gateway/scan_orchestrator.py" = ["E702", "F841"]
"app/services/barcode.py" = ["E702"]
"app/models/batch.py" = ["F821"]
"app/models/location.py" = ["F821"]
"app/models/order_address.py" = ["F821"]
"app/models/permission.py" = ["F821"]
"app/models/role.py" = ["F821"]
"app/models/role_grants.py" = ["F821"]
"app/models/stock.py" = ["F821"]
"app/models/user.py" = ["F821"]
"app/models/warehouse.py" = ["F821"]

# === 这些是之前 Ruff 报错的文件 ===
"alembic/versions/20251105_add_unique_on_stores_platform_name.py" = ["F841"]
"alembic/versions/b17d20cf69a3_stock_ledger_add_location_id_backfill.py" = ["F841"]
"app/db/deps.py" = ["F821"]
"scripts/assert_delta_within.py" = ["F821"]

# === Demo / 样例 / 临时测试 ===
"test_scan_gateway.py" = ["F841"]
"tests/test_scan_gateway.py" = ["F841"]
"tests/services/test_ledger_writer.py" = ["F841"]
"tests/services/test_batch_service.py" = ["F841"]
"tests/services/test_fefo_allocator.py" = ["F841"]
"tests/services/test_channel_inventory_service.py" = ["E402"]
"tests/services/test_event_gateway.py" = ["E402"]
"tests/services/test_snapshot_service_contract.py" = ["E402"]
"tests/quick/test_putaway_idempotency_pg.py" = ["E741"]
