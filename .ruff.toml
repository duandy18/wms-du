# .ruff.toml — WMS-DU stable & backward-compatible config
# =======================================================
# 与 Makefile / pre-commit 配合使用，支持旧版 Ruff（0.5.x~0.6.x）。

# Python 版本
target-version = "py312"
line-length = 100
indent-width = 4

# 扫描路径
src = ["app", "tests", "scripts", "tools"]

# =======================================================
# 🔍 主规则集
# =======================================================
[lint]
select = [
  "E",   # pycodestyle
  "F",   # pyflakes
  "I",   # isort
  "B",   # flake8-bugbear
  "SIM", # flake8-simplify
  "PL",  # pylint-like
  "RUF", # ruff 自身规则
]

# 忽略项（可逐步收紧）
ignore = [
  "E501",     # 行过长交给 black
  "PLR0912",  # 分支过多
  "PLR0913",  # 参数过多
  "PLR2004",  # Magic numbers
  "PLW0603",  # global
  "B008",     # FastAPI Depends 默认参数
  "B007",     # 未使用循环变量
  "SIM117",   # 嵌套 with
  "SIM118",   # “Rewrite using dict()”
]

# =======================================================
# 📁 按目录豁免
# =======================================================
# - tests：忽略中文标点（RUF001/2/3）和长行（E501）
# - alembic/versions：忽略复杂分支和 contextlib 提示
per-file-ignores = {
  "tests/**/*.py" = ["RUF001", "RUF002", "RUF003", "E501"],
  "alembic/**/*.py" = ["PLR0912", "SIM105"],
}

# =======================================================
# ⚙️ isort 设置（旧版 Ruff 兼容字段）
# =======================================================
[lint.isort]
combine-as-imports = true
force-sort-within-sections = true
order-by-type = false
known-first-party = ["app"]
lines-after-imports = 2
from-first = false
case-sensitive = false

# =======================================================
# 🧩 其他选项（可选）
# =======================================================
# 若有 false-positive，可加：
# ignore-init-module-imports = true
# extend-exclude = ["_archive__", "_alembic_bak"]
