# .ruff.toml — WMS-DU stable & backward-compatible config
# =======================================================

target-version = "py312"
line-length = 100
indent-width = 4

# 扫描路径（与 Makefile / pre-commit 一致）
src = ["app", "tests", "scripts", "tools"]

# 主规则集
[lint]
select = [
  "E",   # pycodestyle
  "F",   # pyflakes
  "I",   # isort
  "B",   # flake8-bugbear
  "SIM", # flake8-simplify
  "PL",  # pylint-like
  "RUF", # ruff 自身
]

# 阶段性忽略（逐步收紧）
ignore = [
  "E501",     # 长行交给 Black
  "PLR0912",  # 分支过多
  "PLR0913",  # 参数过多
  "PLR2004",  # Magic numbers
  "PLW0603",  # global
  "B008",     # FastAPI Depends 默认参数
  "B007",     # 未使用循环变量（占位）
  "SIM117",   # 嵌套 with
  "SIM118",   # Rewrite using dict() 暂不强制
]

# 针对目录的豁免
per-file-ignores = {
  # 测试：放宽中文标点和长行（如需要可逐步收紧）
  "tests/**/*.py" = ["RUF001", "RUF002", "RUF003", "E501"],
  # 迁移脚本：分支复杂、容错多
  "alembic/**/*.py" = ["PLR0912", "SIM105"],
}

# isort 设置（旧 Ruff 也支持的键，避免使用 profile）
[lint.isort]
combine-as-imports = true
force-sort-within-sections = true
order-by-type = false
known-first-party = ["app"]
lines-after-imports = 2
from-first = false
case-sensitive = false
