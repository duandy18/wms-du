[pytest]
addopts = -ra
testpaths = tests
asyncio_mode = auto

markers =
    # === 基础测试分类 ===
    smoke: Smoke tests（最轻量的健康检查）
    quick: Quick tests（轻量、运行快）

    # === 当前 v2 内核分类 ===
    grp_core: Core invariants & services（库存内核 / Ledger / Reserve / Concurrency）
    grp_snapshot: Snapshot & views（snapshot_v3、库存切片）
    grp_flow: End-to-end flow（真实链路 E2E / smoke）
    grp_scan: Scan gateway unit scope（legacy alias to grp_flow）
    grp_phase34: Phase 3.4 并发与乱序验证
    contract: Contract-level tests（DB schema / API invariants）

    # === 历史 / 兼容性层 ===
    grp_events: Event gateway / platform adapter tests（legacy integration）
    grp_legacy: Legacy / deprecated flow tests（outbound_v2、snapshot_v1、event_gateway 等）

    # === ★ 核心：中试前必须通过的黄金链路套件 ===
    pre_pilot: Pre-pilot mandatory tests（FEFO 三本账 / 软预占 / 生命周期 v2）

filterwarnings =
    ignore:'crypt' is deprecated and slated for removal in Python 3\.13:DeprecationWarning:passlib\.utils
