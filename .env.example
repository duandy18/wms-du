# ===== WMS-DU Runtime Env (copy to .env or `source .env`) =====
# 时区与 Python 模块路径
export TZ=Asia/Shanghai
export PYTHONPATH=.

# 数据库（Alembic 迁移要求同步驱动；应用层异步用例在测试里自带 asyncpg URL）
# 本地/CI/服务器保持一致端口：5433 (PG14)
export DATABASE_URL='postgresql+psycopg://wms:wms@127.0.0.1:5433/wms'

# -------------------------------
# 平台/特性开关（v1.0 观测期默认关闭）
# -------------------------------
export ENABLE_PDD_PULL=false
export ENABLE_PDD_PUSH=false
export ENABLE_MULTI_WAREHOUSE=false

# -------------------------------
# Web 服务
# -------------------------------
export WMS_HOST=0.0.0.0
export WMS_PORT=8000
export WMS_WORKERS=2

# -------------------------------
# 运行时路径（systemd / 脚本会使用）
# -------------------------------
export WMS_VENV="$HOME/wms-du/.venv"
export WMS_REPO_DIR="$HOME/wms-du"
export WMS_VAR_DIR="$HOME/wms-du/var"
# 首次加载时创建对账等目录（安全幂等）
mkdir -p "$WMS_VAR_DIR/reconcile"

# ===============================================================
# 扫码通路 · 网关配置（v1.0）
# ===============================================================
# 约定：LOC:01R0000000 → RECEIVE（接收入库位）；LOC:01S9000000 → STAGE（上架暂存位）
# 你刚刚已在 DB 中创建：
#   RECEIVE id=10002 (code=01R0000000)
#   STAGE   id=10003 (code=01S9000000)

# —— 默认库位 ——（缺省时网关兜底）
export SCAN_RECEIVE_DEFAULT_LOCATION_ID=10002   # 接收入库位
export SCAN_STAGE_LOCATION_ID=10003             # 上架源位（暂存）

# —— 真动作开关（默认关闭；仅在需要真实落账时开启）——
# 关闭 = 探活（保存点内执行、随后回滚，不落账）
# 开启 = 真动作（提交事务，写入台账与库存）
export SCAN_REAL_RECEIVE=0
export SCAN_REAL_PUTAWAY=0
export SCAN_REAL_PICK=0
export SCAN_REAL_COUNT=0

# 说明：
# - 测试“探活”：
#     PYTHONPATH=. pytest -q tests/services/test_scan_receive.py::test_scan_receive_probe -s -x
# - 测试“真动”：
#     export SCAN_REAL_RECEIVE=1
#     PYTHONPATH=. pytest -q tests/services/test_scan_receive.py::test_scan_receive_real_commit -s -x
# - 扫码契约总跑（当前含 receive+putaway 的探活/真动）：
#     PYTHONPATH=. pytest -q -m grp_scan -s

# ===============================================================
# 日志/可观测（需要时再开启）
# ===============================================================
# export LOG_LEVEL=INFO
# export SQLALCHEMY_ECHO=false

# add your secrets locally
